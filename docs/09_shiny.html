<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Shiny Apps | Cooking with Cal-Adapt Climate Data in R</title>
  <meta name="description" content="Chapter 9 Shiny Apps | Cooking with Cal-Adapt Climate Data in R" />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Shiny Apps | Cooking with Cal-Adapt Climate Data in R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://ucanr-igis.github.io/ca_cookbook//./images/cookbook-cover_640x480.jpg" />
  
  <meta name="github-repo" content="ucanr-igis/ca_cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Shiny Apps | Cooking with Cal-Adapt Climate Data in R" />
  
  
  <meta name="twitter:image" content="https://ucanr-igis.github.io/ca_cookbook//./images/cookbook-cover_640x480.jpg" />




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="08_raster-analyses.html"/>
<link rel="next" href="99_references.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.0.9000/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.0.9000/leaflet-providers-plugin.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./"><strong>Cooking with Cal-Adapt</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#general-workflow"><i class="fa fa-check"></i><b>1.1</b> General Workflow<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#using-climate-data-wisely"><i class="fa fa-check"></i><b>1.2</b> Using Climate Data Wisely<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#video-overviews"><i class="fa fa-check"></i><b>1.3</b> Video Overviews<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02_api-requests.html"><a href="02_api-requests.html"><i class="fa fa-check"></i><b>2</b> API Requests<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="02_api-requests.html"><a href="02_api-requests.html#constructing-cal-adapt-api-requests"><i class="fa fa-check"></i><b>2.1</b> Constructing Cal-Adapt API Requests<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="02_api-requests.html"><a href="02_api-requests.html#checking-an-api-request"><i class="fa fa-check"></i><b>2.2</b> Checking an API Request<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="02_api-requests.html"><a href="02_api-requests.html#locations-of-interest"><i class="fa fa-check"></i><b>2.3</b> Locations of Interest<span></span></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="02_api-requests.html"><a href="02_api-requests.html#longitude-latitude-coordinates"><i class="fa fa-check"></i><b>2.3.1</b> Longitude-Latitude Coordinates<span></span></a></li>
<li class="chapter" data-level="2.3.2" data-path="02_api-requests.html"><a href="02_api-requests.html#simple-feature-data-frame"><i class="fa fa-check"></i><b>2.3.2</b> Simple Feature Data Frame<span></span></a></li>
<li class="chapter" data-level="2.3.3" data-path="02_api-requests.html"><a href="02_api-requests.html#preset-area-of-interest"><i class="fa fa-check"></i><b>2.3.3</b> Preset Area of Interest<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html"><i class="fa fa-check"></i><b>3</b> Time-Series Plots<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#load-packages"><i class="fa fa-check"></i><b>3.1</b> Load Packages<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#time-series-plots-1"><i class="fa fa-check"></i><b>3.2</b> Time Series Plots<span></span></a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#fetch-some-data"><i class="fa fa-check"></i><b>3.2.1</b> Fetch Some Data<span></span></a></li>
<li class="chapter" data-level="3.2.2" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#plot-1.-single-climate-variable-single-rcp"><i class="fa fa-check"></i><b>3.2.2</b> Plot 1. Single Climate Variable &amp; Single RCP<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#multiple-emissions-scenarios"><i class="fa fa-check"></i><b>3.3</b> Multiple Emissions Scenarios<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#overlay-a-trend-line"><i class="fa fa-check"></i><b>3.4</b> Overlay a Trend Line<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#historic-and-future-data-together"><i class="fa fa-check"></i><b>3.5</b> Historic and Future Data Together<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#overlay-a-32-model-ensemble"><i class="fa fa-check"></i><b>3.6</b> Overlay a 32-model Ensemble<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="03_time-series-viz.html"><a href="03_time-series-viz.html#visualize-variability-with-histograms"><i class="fa fa-check"></i><b>3.7</b> Visualize Variability with Histograms<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html"><i class="fa fa-check"></i><b>4</b> Methods for Computing Climate Metrics<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html#load-packages-1"><i class="fa fa-check"></i><b>4.1</b> Load packages<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html#fetch-some-sample-data"><i class="fa fa-check"></i><b>4.2</b> Fetch Some Sample Data<span></span></a></li>
<li class="chapter" data-level="4.3" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html#time-slicing"><i class="fa fa-check"></i><b>4.3</b> Time Slicing<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html#daily-climate-metrics"><i class="fa fa-check"></i><b>4.4</b> Daily Climate Metrics<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html#diurnal-temperature-range"><i class="fa fa-check"></i><b>4.5</b> Diurnal Temperature Range<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html#daily-threshhold-events"><i class="fa fa-check"></i><b>4.6</b> Daily Threshhold Events<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="04_metrics-methods.html"><a href="04_metrics-methods.html#counting-consecutive-events"><i class="fa fa-check"></i><b>4.7</b> Counting Consecutive Events<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html"><i class="fa fa-check"></i><b>5</b> AgroClimate Metrics<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#load-packages-2"><i class="fa fa-check"></i><b>5.1</b> Load Packages<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#fetch-some-data-1"><i class="fa fa-check"></i><b>5.2</b> Fetch Some Data<span></span></a></li>
<li class="chapter" data-level="5.3" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#growing-degree-days"><i class="fa fa-check"></i><b>5.3</b> Growing Degree Days<span></span></a></li>
<li class="chapter" data-level="5.4" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#chill-accumulation"><i class="fa fa-check"></i><b>5.4</b> Chill Accumulation<span></span></a></li>
<li class="chapter" data-level="5.5" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#frost-days"><i class="fa fa-check"></i><b>5.5</b> Frost Days<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#last-spring-and-first-fall-freeze"><i class="fa fa-check"></i><b>5.6</b> Last Spring and First Fall Freeze<span></span></a></li>
<li class="chapter" data-level="5.7" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#freeze-free-season"><i class="fa fa-check"></i><b>5.7</b> Freeze-Free Season<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#tropical-nights-and-hot-days"><i class="fa fa-check"></i><b>5.8</b> Tropical Nights and Hot Days<span></span></a></li>
<li class="chapter" data-level="5.9" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#extreme-heat-days"><i class="fa fa-check"></i><b>5.9</b> Extreme Heat Days<span></span></a></li>
<li class="chapter" data-level="5.10" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#heatwaves"><i class="fa fa-check"></i><b>5.10</b> Heatwaves<span></span></a></li>
<li class="chapter" data-level="5.11" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#diurnal-temperature-range-1"><i class="fa fa-check"></i><b>5.11</b> Diurnal Temperature Range<span></span></a></li>
<li class="chapter" data-level="5.12" data-path="05_agroclimate-metrics.html"><a href="05_agroclimate-metrics.html#reference-evapotranspiration"><i class="fa fa-check"></i><b>5.12</b> Reference Evapotranspiration<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="06_degday.html"><a href="06_degday.html"><i class="fa fa-check"></i><b>6</b> Degree Days<span></span></a></li>
<li class="chapter" data-level="7" data-path="07_joining-other-data.html"><a href="07_joining-other-data.html"><i class="fa fa-check"></i><b>7</b> Joining Other Tables<span></span></a></li>
<li class="chapter" data-level="8" data-path="08_raster-analyses.html"><a href="08_raster-analyses.html"><i class="fa fa-check"></i><b>8</b> Raster Operations<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="08_raster-analyses.html"><a href="08_raster-analyses.html#load-packages-3"><i class="fa fa-check"></i><b>8.1</b> Load Packages<span></span></a></li>
<li class="chapter" data-level="8.2" data-path="08_raster-analyses.html"><a href="08_raster-analyses.html#fetch-tifs"><i class="fa fa-check"></i><b>8.2</b> Fetch TIFs<span></span></a></li>
<li class="chapter" data-level="8.3" data-path="08_raster-analyses.html"><a href="08_raster-analyses.html#import-tifs-in-r"><i class="fa fa-check"></i><b>8.3</b> Import TIFs in R<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="09_shiny.html"><a href="09_shiny.html"><i class="fa fa-check"></i><b>9</b> Shiny Apps<span></span></a></li>
<li class="chapter" data-level="10" data-path="99_references.html"><a href="99_references.html"><i class="fa fa-check"></i><b>10</b> References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with Bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cooking with Cal-Adapt Climate Data in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="shiny-apps" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapter 9</span> Shiny Apps<a href="09_shiny.html#shiny-apps" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>caladaptr can be used in Shiny Apps to retrieve data from the API on-the-fly.</p>
<p>To try out some of these apps, see <a href="https://github.com/ucanr-igis/caladaptr.apps" class="uri">https://github.com/ucanr-igis/caladaptr.apps</a></p>
<p>To show a spinner while data is being fetched, you can do this <a href="https://github.com/ucanr-igis/caladaptr.apps/blob/master/inst/shiny/timeseries/app.r">exampe</a>:</p>
<pre><code>show_spinner() 
my_vals &lt;- ca_getvals_tbl(pt_cap(), quiet = TRUE) 
hide_spinner() </code></pre>
<p>To show a progress bar that updates as data is being retrieved, you can pass a Shiny progress object to <code>ca_getvals_tbl()</code> (<a href="https://github.com/UCANR-IGIS/caladaptr.apps/blob/master/inst/shiny/chill/app.R">example</a>):</p>
<pre><code>progress &lt;- shiny::Progress$new()
on.exit(progress$close())

progress$set(value = 0, message = &quot;Fetching data from Cal-Adapt:&quot;)
    
## Get values
pt_daytmp_tbl &lt;- ca_getvals_tbl(pt_prj_cap(), quiet = TRUE, shiny_progress = progress) </code></pre>
<p>Additional Tips:</p>
<p><em>Deploying your Shiny app without being blocked </em></p>
<p>If you’ll be hosting your ShinyApp on the cloud, there’s a slight possibility that the IP address might be blocked by Cal-Adapt (due to precautions they’ve had to take to defend against DOS attacks)</p>
<ul>
<li><p>ShinyApps.io works fine (those IP addresses have been white listed)</p></li>
<li><p>GoogleCloud IP addresses are all blocked</p></li>
</ul>
<p>If this is a problem, one solution is to 1) get a VM with a stable IP address, 2) ask the administrator of the Cal-Adapt API to white list that IP address.</p>
<p><em>Memory</em></p>
<p>Also, be cognizant of the amount of RAM memory you have to work with. Climate data can quickly consume hundreds of megabytes, and its not uncommon for R to make copies of data frames when doing manipulations. If you’re working on a VM that only has 1 GB of RAM, you can quickly run out of memory. This can be difficult to diagnose, but if your app is working fine on your laptop, but disconnected unexpectedly when you run it on ShinyApps.io, then check the logs for an out-of-memory error.</p>
<p>Your options for dealing with out-of-memory errors include getting a VM with more RAM (which could cost you $), using <code>ca_getvals_db()</code> (which dumps values into a SQLite database) instead of <code>ca_getvals_tbl()</code>, redesigning your app for more efficient use of memory, or making your app available as a zip file that users can run locally from their RStudio.</p>
<p style="font-size:150%; font-style:italic;">
More coming soon…
</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="08_raster-analyses.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="99_references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https\://github.com/ucanr-igis/ca_cookbook/edit/master/09_shiny.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https\://github.com/ucanr-igis/ca_cookbook/edit/master/09_shiny.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "none",
"toc_depth": 2
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
